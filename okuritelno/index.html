<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title></title>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden;
            background: #000;
        }
    </style>
</head>
<body>
<script>
    var canvas = document.createElement('canvas');
    var displayWidth = document.body.clientWidth;
    var displayHeight = document.body.clientHeight;

    var size = Math.min(displayWidth, displayHeight);
    var half = size / 2;
    var cx = displayWidth / 2;
    var cy = displayHeight / 2;
    var pi2 = 2 * Math.PI;
    var pi_2 = Math.PI / 2;

    canvas.setAttribute('width', displayWidth.toString());
    canvas.setAttribute('height', displayHeight.toString());
    document.body.appendChild(canvas);
    var ctx = canvas.getContext('2d');

    ctx.fillStyle = '#000';
    ctx.lineWidth = 2;
    ctx.font = "16px Verdana";

    var log = console.log.bind(console);

    //=================================================
    var particles = [];

    var particleCount = 30;
    var maxVelocity = 2;

    var imageObj = new Image();

    imageObj.onload = function () {
        particles.forEach(function (particle) {
            particle.setImage(imageObj);
        });
    };

    imageObj.src = "/img/smoke.png";

    function Particle(x, y, dx, dy, r) {

        this.x = x || 0;
        this.y = y || 0;

        this.dx = dx || 0;
        this.dy = dy || 0;

        this.r = r || 1;

        this.draw = function () {
            ctx.drawImage(this.image, this.x - 128, this.y - 128);
        };

        this.update = function () {
            this.x += this.dx;
            this.y += this.dy;

            if (this.x >= displayWidth) {
                this.xVelocity = -this.xVelocity;
                this.x = displayWidth;
            } else if (this.x <= 0) {
                this.xVelocity = -this.xVelocity;
                this.x = 0;
            }

            if (this.y >= displayHeight) {
                this.yVelocity = -this.yVelocity;
                this.y = displayHeight;
            } else if (this.y <= 0) {
                this.yVelocity = -this.yVelocity;
                this.y = 0;
            }
        };

        this.setImage = function (image) {
            this.image = image;
        }
    }

    // A function to generate a random number between 2 values
    function generateRandom(min, max) {
        return Math.random() * (max - min) + min;
    }

    for (var i = 0; i < particleCount; ++i) {
        var x = generateRandom(0, displayWidth);
        var y = generateRandom(0, displayHeight);

        var dx = generateRandom(-maxVelocity, maxVelocity);
        var dy = generateRandom(-maxVelocity, maxVelocity);

        var particle = new Particle(x, y, dx, dy, 1);

        particles.push(particle);
    }

    function draw() {
        ctx.clearRect(0, 0, displayWidth, displayHeight);

        particles.forEach(function (particle) {
            particle.draw();
            particle.update();
        });

        requestAnimationFrame(draw);
    }

    draw();

</script>
</body>
</html>