<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title></title>
    <style>body, html {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
    }</style>
</head>
<body>
<script src="js/gl-matrix-min.js"></script>
<script src="js/utils.js"></script>
<script src="js/webgl-utils.js"></script>
<script>
    'use strict';

    window.canvas = document.createElement('canvas');
    document.body.appendChild(canvas);
    window.gl = canvas.getContext('webgl');

    var dWidth, dHeight;
    var resize = function () {
        dWidth = parseFloat(document.body.clientWidth);
        dHeight = parseFloat(document.body.clientHeight);
        canvas.width = dWidth;
        canvas.height = dHeight;
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
    };

    resize();

    window.addEventListener('resize', resize);

    var fromScreen = function (vertices, vSize) {
        var i = 0, len = vertices.length;
        do {
            vertices[i] = (vertices[i] / dWidth) * 2.0 - 1.0;
            vertices[i+1] = 1.0 - (vertices[i+1] / dHeight) * 2.0;
            i += vSize;
        } while (i < len)
    };

    var squareVerticesBuffer;
    var vertexPositionAttribute;
    var rotationMatrixUniform;

    var init = function () {
        gl.clearColor(0.0, 0.06, 0.1, 1.0);
        gl.enable(gl.DEPTH_TEST);
        gl.depthFunc(gl.LEQUAL);
    };

    var initShaders = function () {
        return glu.loadProgram('shaders/vshader.glsl', 'shaders/fshader.glsl').then(function (program) {
            gl.useProgram(program);

            rotationMatrixUniform = gl.getUniformLocation(program, "uRotationMatrix");

            vertexPositionAttribute = gl.getAttribLocation(program, "aVertexPosition");
            gl.enableVertexAttribArray(vertexPositionAttribute);
        });
    };

    var initBuffers = function () {
        squareVerticesBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, squareVerticesBuffer);

        var vertices = [
            0.0, 0.0,
            0.0, 200.0,
            200.0, 0.0,
            200.0, 200.0
        ];

        fromScreen(vertices, 2);

        squareVerticesBuffer.length = vertices.length;

        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
    };

    init();
    initBuffers();
    initShaders().then(function () {
        requestAnimationFrame(draw);
    }, err);

    var rotMat = mat2.create();

    var ot, dt;
    var draw = function (nt) {
        if (!ot) {
            ot = nt;
            requestAnimationFrame(draw);
            return;
        }
        dt = ot - nt;

        requestAnimationFrame(draw);

        mat2.rotate(rotMat, rotMat, 0.001 * dt);
        gl.uniformMatrix2fv(rotationMatrixUniform, false, rotMat);

        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        gl.bindBuffer(gl.ARRAY_BUFFER, squareVerticesBuffer);
        gl.vertexAttribPointer(vertexPositionAttribute, 2, gl.FLOAT, false, 0, 0);
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, squareVerticesBuffer.length / 2);
        ot = nt;
    };

</script>
</body>
</html>